<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <title>Title</title>
</head>
<body onload="fill()">


<form name="newRoomsForm" method="POST" action="controller">
    <input type="hidden" name="command" value="addNewRooms"/>
    <table>
        <thead>
        <tr>
            <th>roomHotel</th>
            <th>roomType</th>
            <th>roomNumber</th>
            <th>bookingStartDate</th>
            <th>bookingEndDate</th>
            <th>status</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</form>

<script type="text/javascript">

    function fill() {
        var entityListConst = "entityList";
        var fieldMapConst = "fieldMap";
        var fieldOrderConst = "fieldOrder";
        var textJson = '{"entityList":[{"roomId":1,"roomHotel":{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},"roomType":{"roomTypeId":1,"name":"Standard Twin","maxPersons":2,"roomPricePerNight":200,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":1,"bookingStartDate":20,"bookingEndDate":400,"roomStatus":"1"},{"roomId":2,"roomHotel":{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},"roomType":{"roomTypeId":2,"name":"Standard Double","maxPersons":2,"roomPricePerNight":300,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":2,"bookingStartDate":30,"bookingEndDate":500,"roomStatus":"1"},{"roomId":6,"roomHotel":{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},"roomType":{"roomTypeId":2,"name":"Standard Double","maxPersons":2,"roomPricePerNight":300,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":6,"bookingStartDate":70,"bookingEndDate":900,"roomStatus":"1"},{"roomId":8,"roomHotel":{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},"roomType":{"roomTypeId":4,"name":"Standard Single","maxPersons":1,"roomPricePerNight":500,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":8,"bookingStartDate":90,"bookingEndDate":1100,"roomStatus":"1"},{"roomId":9,"roomHotel":{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},"roomType":{"roomTypeId":1,"name":"Standard Twin","maxPersons":2,"roomPricePerNight":200,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":9,"bookingStartDate":100,"bookingEndDate":1200,"roomStatus":"1"},{"roomId":3,"roomHotel":{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},"roomType":{"roomTypeId":3,"name":"Family","maxPersons":3,"roomPricePerNight":400,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":3,"bookingStartDate":40,"bookingEndDate":600,"roomStatus":"0"},{"roomId":4,"roomHotel":{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},"roomType":{"roomTypeId":4,"name":"Standard Single","maxPersons":1,"roomPricePerNight":500,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":4,"bookingStartDate":50,"bookingEndDate":700,"roomStatus":"0"},{"roomId":5,"roomHotel":{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},"roomType":{"roomTypeId":5,"name":"Huge","maxPersons":4,"roomPricePerNight":600,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":5,"bookingStartDate":60,"bookingEndDate":800,"roomStatus":"0"},{"roomId":7,"roomHotel":{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},"roomType":{"roomTypeId":3,"name":"Family","maxPersons":3,"roomPricePerNight":400,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},"roomNumber":7,"bookingStartDate":80,"bookingEndDate":1000,"roomStatus":"1"}],"fieldMap":{"roomHotel":[{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"},{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},{"hotelId":1,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"Belarus Hotel","hotelStatus":"active"},{"hotelId":2,"hotelLocation":{"locationId":1,"country":"Belarus","city":"Minsk","locationStatus":"active"},"hotelName":"U Fontana","hotelStatus":"active"}],"roomType":[{"roomTypeId":4,"name":"Standard Single","maxPersons":1,"roomPricePerNight":500,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},{"roomTypeId":5,"name":"Huge","maxPersons":4,"roomPricePerNight":600,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},{"roomTypeId":3,"name":"Family","maxPersons":3,"roomPricePerNight":400,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},{"roomTypeId":2,"name":"Standard Double","maxPersons":2,"roomPricePerNight":300,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"},{"roomTypeId":1,"name":"Standard Twin","maxPersons":2,"roomPricePerNight":200,"facilities":["safe","wi-fi"],"roomTypeStatus":"1"}]}}';
        var objectMap = JSON.parse(textJson);
        var entityList = objectMap[entityListConst];
        var fieldsOrder = objectMap[fieldOrderConst];
        var objectMapKeys = Object.keys(objectMap);
        var objectMapKeysLength = objectMapKeys.length;
        var fieldVariants = objectMap[fieldMapConst];
        for (var entity of entityList) {
            var tableRow = $("<tr></tr>");
            $("tbody").append(tableRow);
            getEntityFields(entity, fieldVariants);
        }
    }

    function getTableElement(entity, field) {
        var fieldValue = entity[field];
        var tableElement;
        if (typeof fieldValue == "object") {
            if (Array.isArray(fieldValue)) {
                tableElement = getArrayAsString(fieldValue);
            } else {
                var keys = Object.keys(fieldValue);
                tableElement = fieldValue[keys[0]];
            }
        } else {
            tableElement = fieldValue;
        }
        return tableElement
    }

    function getEntityFields(entity, fieldVariants) {
        var entityFields = Object.keys(entity);
        for (let field of entityFields) {
            var fieldValue = entity[field];
            var tableElement;
            if (typeof fieldValue == "object") {
                if (Array.isArray(fieldValue)) {
                    tableElement = getArrayAsString(fieldValue);
                } else {
                    var keys = Object.keys(fieldValue);
                    tableElement = fieldValue;
                }
            } else {
                tableElement = fieldValue;
            }
            var input;
            var idRegExp = /\w+Id/;
            if (field.match(idRegExp)) {
                input = $("<input type='hidden'>");
                input.attr({
                    "nsme": field,
                    "value": tableElement
                });
            } else if (fieldVariants.hasOwnProperty(field)) {
                input = $("<select></select>");
                input.attr("name", field);
                $("tr").last().append("<td></td>");
                var thisFieldVariants = fieldVariants[field];
                for (let variant of thisFieldVariants) {
                    var isSelected = false;
                    var option = $("<option></option>");
                    if ((typeof variant) == "object") {
                        var thisKeys = Object.keys(tableElement);
                        var thisEntityId = tableElement[thisKeys[0]];
                        var entityId = variant[thisKeys[0]];
                        option.text(entityId);
                        if (entityId == thisEntityId) {
                            isSelected = true;
                            option.attr("selected", "selected");
                        }
                    } else {
                        option.text(variant);
                        if (tableElement == variant) {
                            isSelected = true;
                            option.attr("selected", "selected");
                        }
                    }
                    input.append(option);
                }
            } else {
                input = $("<input type='text'>");
                input.attr({
                    "nsme": field,
                    "value": tableElement
                });
                $("tr").last().append("<td></td>");
            }
            input.attr({
                "nsme": field,
                "value": tableElement
            });
            $("td").last().prepend(input);
        }
    }

    function getArrayAsString(array) {
        var arrayAsString;
        for (let element of array) {
            if (arrayAsString == undefined) {
                arrayAsString = element;
            } else {
                arrayAsString += ", " + element;
            }
        }
        return arrayAsString;
    }



</script>
</body>
</html>