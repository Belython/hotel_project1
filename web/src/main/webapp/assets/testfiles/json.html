<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <title>Title</title>
</head>
<body onload="fill()">

<form name="test">
    <input type="date" name="date">
</form>

<form name="newRoomsForm" method="POST" action="controller">
    <input type="hidden" name="command" value="addNewRooms"/>
    <table>
        <thead>
        <tr>
            <th>roomHotel</th>
            <th>roomType</th>
            <th>roomNumber</th>
            <th>bookingStartDate</th>
            <th>bookingEndDate</th>
            <th>status</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</form>

<script type="text/javascript">

    function fill() {
        var entityListConst = "entityList";
        var fieldMapConst = "fieldMap";
        var fieldOrderConst = "fieldOrder";
        var textJson = '{"entityList":[{"roomId":2,"roomHotel":{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},"roomType":{"roomTypeId":2,"roomTypeName":"Standard Double","mapPersons":2,"pricePerNight":300,"facilities":["safe","wi-fi"]},"roomNumber":2,"bookingStartDate":30,"bookingEndDate":500},{"roomId":6,"roomHotel":{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},"roomType":{"roomTypeId":2,"roomTypeName":"Standard Double","mapPersons":2,"pricePerNight":300,"facilities":["safe","wi-fi"]},"roomNumber":6,"bookingStartDate":70,"bookingEndDate":900},{"roomId":1,"roomHotel":{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},"roomType":{"roomTypeId":1,"roomTypeName":"Standard Twin","mapPersons":2,"pricePerNight":200,"facilities":["safe","wi-fi"]},"roomNumber":1,"bookingStartDate":20,"bookingEndDate":400},{"roomId":9,"roomHotel":{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},"roomType":{"roomTypeId":1,"roomTypeName":"Standard Twin","mapPersons":2,"pricePerNight":200,"facilities":["safe","wi-fi"]},"roomNumber":9,"bookingStartDate":100,"bookingEndDate":1200},{"roomId":3,"roomHotel":{"hotelId":2,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"U Fontana"},"roomType":{"roomTypeId":3,"roomTypeName":"Family","mapPersons":3,"pricePerNight":400,"facilities":["safe","wi-fi"]},"roomNumber":3,"bookingStartDate":40,"bookingEndDate":600},{"roomId":7,"roomHotel":{"hotelId":2,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"U Fontana"},"roomType":{"roomTypeId":3,"roomTypeName":"Family","mapPersons":3,"pricePerNight":400,"facilities":["safe","wi-fi"]},"roomNumber":7,"bookingStartDate":80,"bookingEndDate":1000},{"roomId":8,"roomHotel":{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},"roomType":{"roomTypeId":4,"roomTypeName":"Standard Single","mapPersons":1,"pricePerNight":500,"facilities":["safe","wi-fi"]},"roomNumber":8,"bookingStartDate":90,"bookingEndDate":1100},{"roomId":5,"roomHotel":{"hotelId":2,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"U Fontana"},"roomType":{"roomTypeId":5,"roomTypeName":"Huge","mapPersons":4,"pricePerNight":600,"facilities":["safe","wi-fi"]},"roomNumber":5,"bookingStartDate":60,"bookingEndDate":800},{"roomId":4,"roomHotel":{"hotelId":2,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"U Fontana"},"roomType":{"roomTypeId":4,"roomTypeName":"Standard Single","mapPersons":1,"pricePerNight":500,"facilities":["safe","wi-fi"]},"roomNumber":4,"bookingStartDate":50,"bookingEndDate":700}],"fieldMap":{"roomHotel":[{"hotelId":1,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"Belarus Hotel"},{"hotelId":2,"hotelCountry":"Belarus","hotelCity":"Minsk","hotelName":"U Fontana"}],"roomType":[{"roomTypeId":1,"roomTypeName":"Standard Twin","mapPersons":2,"pricePerNight":200,"facilities":["safe","wi-fi"]},{"roomTypeId":4,"roomTypeName":"Standard Single","mapPersons":1,"pricePerNight":500,"facilities":["safe","wi-fi"]},{"roomTypeId":5,"roomTypeName":"Huge","mapPersons":4,"pricePerNight":600,"facilities":["safe","wi-fi"]},{"roomTypeId":3,"roomTypeName":"Family","mapPersons":3,"pricePerNight":400,"facilities":["safe","wi-fi"]},{"roomTypeId":2,"roomTypeName":"Standard Double","mapPersons":2,"pricePerNight":300,"facilities":["safe","wi-fi"]}]}}';
        var objectMap = JSON.parse(textJson);
        var entityList = objectMap[entityListConst];
        var fieldsOrder = objectMap[fieldOrderConst];
        var objectMapKeys = Object.keys(objectMap);
        var objectMapKeysLength = objectMapKeys.length;
        var fieldVariants = objectMap[fieldMapConst];
        for (var entity of entityList) {
            var tableRow = $("<tr></tr>");
            $("tbody").append(tableRow);
            getEntityFields(entity, fieldVariants);
        }
    }

    function getTableElementText(entity, field) {
        var fieldValue = entity[field];
        var tableElementText = "";
        if (typeof fieldValue == "object") {
            if (Array.isArray(fieldValue)) {
                tableElementText = getArrayAsString(fieldValue);
            } else {
                tableElementText = getEntityAsString(fieldValue);
            }
        } else {
            tableElementText = fieldValue;
        }
        return tableElementText;
    }
    
    function getTableElement(tableElementText, fieldName, fieldVariants) {
        var input;
        var idRegExp = /\w+Id/;
        if (fieldName.match(idRegExp)) {
            input = $("<input type='hidden'>").attr({
                "nsme": fieldName,
                "value": tableElementText
            });
        } else if (fieldVariants.hasOwnProperty(fieldName)) {
            var input1 = $("<select></select>").attr("name", fieldName);
            $("tr").last().append("<td></td>");
            $("td").last().append(input1);
            var thisFieldVariants = fieldVariants[fieldName];
            for (let fieldVariant of thisFieldVariants) {
                var option = $("<option></option>");
                $("select").last().append(option);
                var variantText = "";
                if ((typeof fieldVariant) == "object") {
                    var entityKeys = Object.keys(fieldVariant);
                    var entityId = fieldVariant[entityKeys[0]];
                    var entityIdInput = $("<input>").attr({
                        "type": "hidden",
                        "name": entityKeys[0],
                        "value": entityId
                    });
                    $("option").last().prepend(entityIdInput);
                    variantText = getEntityAsString(fieldVariant);
                } else {
                    variantText = fieldVariant;
                }
                $("option").last().append(variantText);
                if (tableElementText == variantText) {
                    $("option").last().attr("selected", "selected");
                }
            }
        } else {
            input = $("<input type='text'>").attr({
                "nsme": fieldName,
                "value": tableElementText
            });
            $("tr").last().append("<td></td>");
        }
        return input;
    }

    function getEntityAsString(entity) {
        var string;
        var entityKeys = Object.keys(entity);
        for (let enitityKey of entityKeys) {
            var field = entity[enitityKey];
            var fieldValue;
            if (Array.isArray(field)) {
                fieldValue = getArrayAsString(field);
            } else {
                fieldValue = field;
            }
            if (string == undefined) {
                string = entity[enitityKey];
            } else {
                string += ", " + entity[enitityKey];
            }

        }
        return string;
    }

    function getEntityFields(entity, fieldVariants) {
        var entityFields = Object.keys(entity);
        for (let fieldName of entityFields) {
            var tableElementText = getTableElementText(entity, fieldName);
            var input = getTableElement(tableElementText, fieldName, fieldVariants);
            $("td").last().prepend(input);
        }
    }

    function getArrayAsString(array) {
        var arrayAsString;
        for (let element of array) {
            if (arrayAsString == undefined) {
                arrayAsString = element;
            } else {
                arrayAsString += ", " + element;
            }
        }
        return arrayAsString;
    }



</script>
</body>
</html>